## LocalMom 요구사항 보강/개선 제안 (Gap Analysis)

본 문서는 `requirements.md`를 **개발 관점(실구현/운영/보안/정산/법무)**에서 점검하여, 누락된 요구사항과 더 나은 설계 방향을 제안합니다.

---

## 1) 핵심 누락/모호 영역 (반드시 결정 필요)

### 1.1 결제/정산/출금(현금성 지급) 정책
- **광고주 결제**
  - 결제 수단(PG): 카드/계좌이체/가상계좌 중 무엇을 MVP로 할지
  - 환불 규칙: 캠페인 중지/미집행 물량 환불(정산 단위, 수수료 처리)
- **리워더 출금**
  - 출금 주기(예: D+N), 최소 출금액, 출금 수수료, 반려 사유 정책
  - KYC/실명/계좌 인증 필요 여부(현금성 지급은 규제/부정 방지 이슈가 큼)
  - 세금/원천징수 처리 범위(추후로 두더라도 데이터 모델은 대비 필요)

### 1.2 “미션 인증”의 기술 범위(로그/리다이렉트/앱연동)
요구사항에 “링크 클릭 로그/체류시간/자동 인증”이 있으나, 구현 난이도가 큽니다.
- **MVP 권장**: “스크린샷 + OCR + 간단 로그(딥링크 클릭 이벤트)” 조합
- **차기 권장**: 모바일 앱/SDK를 통한 체류시간/행동 로그 수집(웹만으로는 한계)

### 1.3 부정 방지 정책(명확한 룰셋 필요)
다음 항목을 “정책 파라미터”로 정의해야 운영이 가능합니다.
- 1인 1일 제한: 미션별/플레이스별/캠페인별 기준
- 동일 플레이스 반복 참여 허용 기준(저장/공유는 특히 중복이 문제)
- IP/디바이스 제한의 강도(차단/감점/추가 인증 등 단계화)
- “너무 빠른 연속 수행”의 정의(초 단위, 일 단위) 및 패널티 단계

### 1.4 법무/플랫폼 정책(외부 플랫폼 규정)
네이버 플레이스/검색 행동을 유도하는 형태는 **정책 위반/계정 제재/법적 리스크**가 발생할 수 있습니다.
- 서비스 약관/리워더 행동 가이드/광고주 정책(금지 행위) 문구가 필수
- “검증된 정상 참여 데이터”의 정의(법/약관 상 허용 가능한 방식) 확정 필요

---

## 2) 아키텍처 관점 개선 제안 (Next.js + Vercel 제약 고려)

### 2.1 Vercel(서버리스)에서 장시간 작업 분리
OCR/중복 이미지 판별/부정 탐지 등은 비동기 작업이 적합합니다.
- 권장: **Job Queue(예: Upstash QStash)** + Worker(서버리스 함수/크론)
- 결과는 DB에 저장하고, UI는 “검수 대기 → 승인/반려” 형태로 폴링/리프레시

### 2.2 돈/정산은 “원장(Ledger) 우선”으로 설계
크레딧/예산/환불은 반드시 원장 기반으로 해야 정합성이 유지됩니다.
- `CreditLedger`(리워더) / `BudgetLedger`(광고주) 형태를 권장
- 화면에 보이는 잔액은 원장 합계로 계산(캐시는 보조)

### 2.3 멱등성(Idempotency) 필수
결제/출금/미션 승인 같은 기능은 재시도/중복 요청이 흔합니다.
- `idempotency_key` 저장 및 재처리 방지
- 외부 PG/출금 API 연동 시 Webhook 처리도 멱등하게

### 2.4 “미션 슬롯 확보”는 트랜잭션/락으로 처리
동시 요청이 많을 수 있어, `quota_remaining` 감소는 트랜잭션이 필요합니다.
- `SELECT ... FOR UPDATE` 또는 `UPDATE ... WHERE quota_remaining > 0` 방식
- Prisma에서는 `transaction()` + 조건 업데이트 패턴 권장

---

## 3) 제품/UX 개선 제안 (MVP 성공 확률↑)

### 3.1 MVP 범위 축소(성공 기준 명확화)
- MVP는 **트래픽(방문) 1종** + **스크린샷 OCR 검수**로 시작
- “자동 인증/머신러닝”은 Phase 2로 이동

### 3.2 광고주 신뢰를 위한 핵심 UX
- 캠페인 생성 시 “예상 비용/일일 소진 예상/리워드 분배”를 명확히 표시
- 리포트는 “일별 수행량/승인율/반려율/부정탐지” 중심

### 3.3 리워더 신뢰/안전장치
- 미션 상세에 “반려 기준”을 구체적으로 노출
- 반려 시 재제출 가능 여부/기한/가이드 제공

---

## 4) 운영/보안 필수 요구사항 추가 제안

- 관리자 작업(정산 승인/제재/정책 변경)은 **감사로그(Audit Log)** 필수
- 파일 업로드는 바이러스 스캔/콘텐츠 타입 검증/서명 URL 권장
- 레이트 리밋(로그인/미션 시작/인증 업로드)에 대한 정책 필요
- 민감정보(계좌/실명 등)는 암호화/마스킹/접근통제 필요


