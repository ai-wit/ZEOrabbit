## LocalMom 개발 계획 (Next.js App Router + Prisma + MySQL + Vercel)

---

## 0) MVP 정의(성공 기준)

### MVP 범위(권장)
- 미션 타입: **TRAFFIC(방문) 1종**
- 인증: **스크린샷 업로드 + OCR(또는 관리자 검수)**
- 자동 인증(체류시간/로그 고도화), 저장/공유, 모바일 앱은 Phase 2+

### 성공 기준(예시)
- 광고주:
  - 캠페인 생성/활성화/일별 진행률 확인/예산 소진 확인 가능
- 리워더:
  - 미션 리스트 → 슬롯 확보 → 인증 제출 → 승인 시 크레딧 적립 → 출금 신청 가능
- 운영:
  - 관리자 검수/정산 승인/제재가 가능하고 감사로그가 남음

---

## 1) 마일스톤/단계(구체)

### 1.1 Phase 0 — 프로젝트 셋업(0.5~1주)
- 레포 초기화(Next.js 14+, TS, Tailwind)
- Prisma + MySQL 연결, 마이그레이션 파이프라인 구성
- 기본 레이아웃/디자인 시스템(컴포넌트 규칙, 폼/테이블)
- 환경변수/시크릿 정책(Vercel env) 정리

**산출물**
- `prisma/schema.prisma` 기반 DB 마이그레이션
- 공통 UI(로그인, 레이아웃, 네비게이션)

### 1.2 Phase 1 — 인증/역할/권한(1주)
- 회원가입/로그인
- 역할 선택(광고주/리워더)
- 권한 가드(라우트/서버 액션/핸들러)
- 약관 동의(최소 저장)

**수용 기준(AC)**
- 광고주/리워더가 서로의 영역 접근 불가
- 관리자만 관리자 페이지 접근 가능

### 1.3 Phase 2 — 광고주 핵심(캠페인/플레이스/예산)(1~2주)
- 플레이스 CRUD(광고주 소유)
- 캠페인 생성(DRAFT) + 검수(자동/수동) + 활성화
- 활성화 시 MissionDay 생성(기간 전체, 멱등)
- 광고주 대시보드(요약 + 캠페인 리스트 + 상세 리포트 기본)

**수용 기준(AC)**
- 캠페인 생성 시 예산/보상/단가가 정책에 따라 계산됨
- 캠페인 활성화 시 일별 미션이 생성되고, 조회 시 “남은 수량”이 노출됨

### 1.4 Phase 3 — 리워더 핵심(미션/슬롯/인증)(1~2주)
- 오늘의 미션 리스트(필터: 타입/시간/리워드)
- “미션 시작하기”(슬롯 확보, 트랜잭션)
- 인증 업로드(스크린샷) + 참여 내역(상태별)
- 만료 처리(크론/요청 시 정리) + (정책에 따라) quota 반환 여부 결정

**수용 기준(AC)**
- quotaRemaining이 0이면 슬롯 확보 불가
- 동일 미션에 중복 참여(활성 상태) 불가
- 제출 후 상태가 PENDING_REVIEW로 전환되고, 참여 내역에서 확인 가능

### 1.5 Phase 4 — 검수(자동/수동) + 원장(크레딧/예산)(1~2주)
- 자동 검수 Job 파이프라인(최소: OCR 텍스트 룰)
- 관리자 수동 검수 화면(승인/반려/사유 입력)
- 승인 시 `CreditLedger`/`BudgetLedger` 반영(멱등/유니크)
- 광고주 리포트: 승인율/반려율/부정 신호(기초)

**수용 기준(AC)**
- 같은 참여 건이 중복 승인되어도 원장이 중복 적재되지 않음
- 관리자 승인/반려는 감사로그가 남음

### 1.6 Phase 5 — 출금(정산) + 운영(1~2주)
- 리워더 출금 계좌 등록(마스킹 저장, KYC는 차기)
- 출금 신청/목록/상태
- 관리자 출금 승인/반려/보류 및 감사로그
- 최소 레이트리밋/블랙리스트/제재(SUSPENDED) 반영

**수용 기준(AC)**
- 출금 신청 시 크레딧 잔액 부족이면 실패
- 승인 시 `CreditLedger`에 PAYOUT 차감이 기록되고, 상태가 PAID로 전환 가능

---

## 2) 작업 분해(구현 체크리스트)

### 2.1 데이터/정책
- 정책 테이블(`policy`)에 MVP용 기본 정책 JSON 적재
- 가격/보상/제한/부정 임계치 등 운영 파라미터는 코드 하드코딩 금지(초기값은 seed로)

### 2.2 동시성/정합성
- 슬롯 확보: 트랜잭션 + 조건 업데이트
- 원장 반영: `(reason, refId)` 유니크로 멱등 보장
- 웹훅(결제): `providerRef` 유니크로 중복 처리 방지

### 2.3 파일 업로드
- 서버리스 환경 고려: presigned upload(권장) 또는 서버 업로드(용량 제한 주의)
- 업로드 파일 타입/용량 제한, 악성 파일 방지(추가)

---

## 3) 테스트 전략(최소)

- 도메인 로직 단위 테스트:
  - 슬롯 확보(동시성 시나리오)
  - 상태 전이(만료/반려/승인)
  - 원장 멱등성
- E2E(핵심 플로우 2개):
  - 리워더: 미션 시작 → 인증 제출 → 관리자 승인 → 크레딧 반영
  - 광고주: 캠페인 활성화 → 일별 진행률 확인

---

## 4) 출시/운영 체크

- 감사로그/관리자 권한/시크릿 관리(Vercel) 확인
- 모니터링 지표(승인율, 반려율, 출금 처리 시간, 부정탐지 건수) 대시보드 정의
- 약관/개인정보/행동 가이드 문서 확정(법무 리스크 최소화)


